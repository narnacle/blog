<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>How Secure Shell Works (SSH) | Narnacle&#39;s Dev Blog</title>
<meta name="keywords" content="Ssh, Linux">
<meta name="description" content="SSH (Secure Shell) is a cryptographic network protocol used to securely connect to remote systems over an unsecured network. It’s commonly used for managing servers, accessing network devices, and transferring files securely. Here’s a simple breakdown of how it works:
1. Client and Server

Client: The system trying to access another system remotely. Usually, you run an SSH client (like ssh on Unix/Linux or PuTTY on Windows).
Server: The remote system that the client wants to connect to, which runs an SSH server (like sshd on Unix/Linux).

2. Initiating the Connection

When you try to connect to a remote system using SSH, the client sends a request to the SSH server on a specific port (usually port 22).
The server then responds by sending its public key to the client.

3. Key Exchange and Authentication


Key Exchange: The client and server exchange encryption keys to establish a secure communication channel. They use algorithms like Diffie-Hellman or Elliptic Curve Diffie-Hellman (ECDH) for this. This ensures that even if someone is eavesdropping on the connection, they won’t be able to decrypt the data.">
<meta name="author" content="Narnacle">
<link rel="canonical" href="http://localhost:1313/posts/how-secure-shell-works/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.bea5c689ac807964c17b1d5272e6406e87542486b750fbdde18848f4a1e39635.css" integrity="sha256-vqXGiayAeWTBex1ScuZAbodUJIa3UPvd4YhI9KHjljU=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/narnacle.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/how-secure-shell-works/">
<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="How Secure Shell Works (SSH) | Narnacle&#39;s Dev Blog" />
<meta name="twitter:description" content="SSH (Secure Shell) is a cryptographic network protocol used to securely connect to remote systems over an unsecured network. It’s commonly used for managing servers, accessing network devices, and transferring files securely. Here’s a simple breakdown of how it works:
1. Client and Server

Client: The system trying to access another system remotely. Usually, you run an SSH client (like ssh on Unix/Linux or PuTTY on Windows).
Server: The remote system that the client wants to connect to, which runs an SSH server (like sshd on Unix/Linux).

2. Initiating the Connection

When you try to connect to a remote system using SSH, the client sends a request to the SSH server on a specific port (usually port 22).
The server then responds by sending its public key to the client.

3. Key Exchange and Authentication


Key Exchange: The client and server exchange encryption keys to establish a secure communication channel. They use algorithms like Diffie-Hellman or Elliptic Curve Diffie-Hellman (ECDH) for this. This ensures that even if someone is eavesdropping on the connection, they won’t be able to decrypt the data." />
<meta property="og:title" content="How Secure Shell Works (SSH) | Narnacle&#39;s Dev Blog" />
<meta property="og:description" content="SSH (Secure Shell) is a cryptographic network protocol used to securely connect to remote systems over an unsecured network. It’s commonly used for managing servers, accessing network devices, and transferring files securely. Here’s a simple breakdown of how it works:
1. Client and Server

Client: The system trying to access another system remotely. Usually, you run an SSH client (like ssh on Unix/Linux or PuTTY on Windows).
Server: The remote system that the client wants to connect to, which runs an SSH server (like sshd on Unix/Linux).

2. Initiating the Connection

When you try to connect to a remote system using SSH, the client sends a request to the SSH server on a specific port (usually port 22).
The server then responds by sending its public key to the client.

3. Key Exchange and Authentication


Key Exchange: The client and server exchange encryption keys to establish a secure communication channel. They use algorithms like Diffie-Hellman or Elliptic Curve Diffie-Hellman (ECDH) for this. This ensures that even if someone is eavesdropping on the connection, they won’t be able to decrypt the data." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/how-secure-shell-works/" />
    <meta property="og:image" content="http://localhost:1313/narnacle.png"/>
<meta property="article:section" content="posts" />
  <meta property="article:published_time" content="2025-07-18T14:00:00&#43;03:00" />
  <meta property="article:modified_time" content="2025-07-18T14:00:00&#43;03:00" />


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "How Secure Shell Works (SSH)",
      "item": "http://localhost:1313/posts/how-secure-shell-works/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "How Secure Shell Works (SSH) | Narnacle's Dev Blog",
  "name": "How Secure Shell Works (SSH)",
  "description": "SSH (Secure Shell) is a cryptographic network protocol used to securely connect to remote systems over an unsecured network. It’s commonly used for managing servers, accessing network devices, and transferring files securely. Here’s a simple breakdown of how it works:\n1. Client and Server Client: The system trying to access another system remotely. Usually, you run an SSH client (like ssh on Unix/Linux or PuTTY on Windows). Server: The remote system that the client wants to connect to, which runs an SSH server (like sshd on Unix/Linux). 2. Initiating the Connection When you try to connect to a remote system using SSH, the client sends a request to the SSH server on a specific port (usually port 22). The server then responds by sending its public key to the client. 3. Key Exchange and Authentication Key Exchange: The client and server exchange encryption keys to establish a secure communication channel. They use algorithms like Diffie-Hellman or Elliptic Curve Diffie-Hellman (ECDH) for this. This ensures that even if someone is eavesdropping on the connection, they won’t be able to decrypt the data.\n",
  "keywords": [
    "Ssh", "Linux"
  ],
  "wordCount" : "526",
  "inLanguage": "en",
  "datePublished": "2025-07-18T14:00:00+03:00",
  "dateModified": "2025-07-18T14:00:00+03:00",
  "author":{
    "@type": "Person",
    "name": "Narnacle"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/how-secure-shell-works/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Narnacle's Dev Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/narnacle.png"
    }
  }
}
</script>
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>

</head>

<body class=" dark type-posts kind-page layout-" id="top"><script data-no-instant>
function switchTheme(theme) {
  switch (theme) {
    case 'light':
      document.body.classList.remove('dark');
      break;
    case 'dark':
      document.body.classList.add('dark');
      break;
    
    default:
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
      }
  }
}

function isDarkTheme() {
  return document.body.className.includes("dark");
}

function getPrefTheme() {
  return localStorage.getItem("pref-theme");
}

function setPrefTheme(theme) {
  switchTheme(theme)
  localStorage.setItem("pref-theme", theme);
}

const toggleThemeCallbacks = {}
toggleThemeCallbacks['main'] = (isDark) => {
  
  if (isDark) {
    setPrefTheme('light');
  } else {
    setPrefTheme('dark');
  }
}




window.addEventListener('toggle-theme', function() {
  
  const isDark = isDarkTheme()
  for (const key in toggleThemeCallbacks) {
    toggleThemeCallbacks[key](isDark)
  }
});


function toggleThemeListener() {
  
  window.dispatchEvent(new CustomEvent('toggle-theme'));
}

</script>
<script>
  
  (function() {
    const defaultTheme = 'dark';
    const prefTheme = getPrefTheme();
    const theme = prefTheme ? prefTheme : defaultTheme;

    switchTheme(theme);
  })();
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Narnacle&#39;s Dev Blog (Alt + H)">
                    <img src="http://localhost:1313/narnacle.png" alt="logo" aria-label="logo"
                        height="30" width="30">Narnacle&#39;s Dev Blog</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="Posts" class="active"
                >Posts
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/about/" title="About"
                >About
                </a>
            </li>
            <li>
                <a href="https://rb.gy/a6ylyh/" title="NEWSLETTER" target="_blank"
                >NEWSLETTER<span class="external-link"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-external-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M11 7h-5a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-5" />
  <line x1="10" y1="14" x2="20" y2="4" />
  <polyline points="15 4 20 4 20 9" />
</svg>
</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search the site"
                >Search
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main post">

<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">How Secure Shell Works (SSH)</h1>
    <div class="post-meta"><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select: text;"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select: text;"></rect><line x1="16" y1="2" x2="16" y2="6" style="user-select: text;"></line><line x1="8" y1="2" x2="8" y2="6" style="user-select: text;"></line><line x1="3" y1="10" x2="21" y2="10" style="user-select: text;"></line></svg>
  <span>July 18, 2025</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select: text;"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" style="user-select: text;"></path><line x1="7" y1="7" x2="7" y2="7" style="user-select: text;"></line></svg>
  <span class="post-tags"><a href="http://localhost:1313/tags/ssh/">Ssh</a><a href="http://localhost:1313/tags/linux/">Linux</a></span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select: text;"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" style="user-select: text;"></path><polyline points="14 2 14 8 20 8" style="user-select: text;"></polyline><line x1="16" y1="13" x2="8" y2="13" style="user-select: text;"></line><line x1="16" y1="17" x2="8" y2="17" style="user-select: text;"></line><polyline points="10 9 9 9 8 9" style="user-select: text;"></polyline></svg>
  <span>526 words</span></span><span class="meta-item">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><circle cx="12" cy="12" r="9"></circle><polyline points="12 7 12 12 15 15"></polyline></svg>
  <span>3 min</span></span>

      
      
    </div>
  </header> <div class="toc side right">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#1-client-and-server" aria-label="1. Client and Server">1. <strong>Client and Server</strong></a></li>
                <li>
                    <a href="#2-initiating-the-connection" aria-label="2. Initiating the Connection">2. <strong>Initiating the Connection</strong></a></li>
                <li>
                    <a href="#3-key-exchange-and-authentication" aria-label="3. Key Exchange and Authentication">3. <strong>Key Exchange and Authentication</strong></a></li>
                <li>
                    <a href="#4-encrypted-communication" aria-label="4. Encrypted Communication">4. <strong>Encrypted Communication</strong></a></li>
                <li>
                    <a href="#5-session-termination" aria-label="5. Session Termination">5. <strong>Session Termination</strong></a></li>
                <li>
                    <a href="#key-components-of-ssh" aria-label="Key Components of SSH:">Key Components of SSH:</a></li>
                <li>
                    <a href="#ssh-use-cases" aria-label="SSH Use Cases:">SSH Use Cases:</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>SSH (Secure Shell) is a cryptographic network protocol used to securely connect to remote systems over an unsecured network. It’s commonly used for managing servers, accessing network devices, and transferring files securely. Here’s a simple breakdown of how it works:</p>
<h3 id="1-client-and-server">1. <strong>Client and Server</strong><a hidden class="anchor" aria-hidden="true" href="#1-client-and-server">¶</a></h3>
<ul>
<li><strong>Client</strong>: The system trying to access another system remotely. Usually, you run an SSH client (like <code>ssh</code> on Unix/Linux or PuTTY on Windows).</li>
<li><strong>Server</strong>: The remote system that the client wants to connect to, which runs an SSH server (like <code>sshd</code> on Unix/Linux).</li>
</ul>
<h3 id="2-initiating-the-connection">2. <strong>Initiating the Connection</strong><a hidden class="anchor" aria-hidden="true" href="#2-initiating-the-connection">¶</a></h3>
<ul>
<li>When you try to connect to a remote system using SSH, the client sends a request to the SSH server on a specific port (usually port 22).</li>
<li>The server then responds by sending its public key to the client.</li>
</ul>
<h3 id="3-key-exchange-and-authentication">3. <strong>Key Exchange and Authentication</strong><a hidden class="anchor" aria-hidden="true" href="#3-key-exchange-and-authentication">¶</a></h3>
<ul>
<li>
<p><strong>Key Exchange</strong>: The client and server exchange encryption keys to establish a secure communication channel. They use algorithms like Diffie-Hellman or Elliptic Curve Diffie-Hellman (ECDH) for this. This ensures that even if someone is eavesdropping on the connection, they won’t be able to decrypt the data.</p>
</li>
<li>
<p><strong>Server Authentication</strong>: The client checks the server’s public key to ensure it is connecting to the right system. This prevents Man-in-the-Middle (MITM) attacks.</p>
</li>
<li>
<p><strong>Client Authentication</strong>: The client must authenticate itself to the server. There are two main ways to do this:</p>
<ol>
<li><strong>Password-based authentication</strong>: The client provides a password to authenticate itself.</li>
<li><strong>Key-based authentication</strong>: The client uses a pair of cryptographic keys—public and private keys. The public key is stored on the server, and the private key remains with the client. The server sends a challenge to the client, which can only be answered correctly by the private key holder, ensuring secure authentication.</li>
</ol>
</li>
</ul>
<h3 id="4-encrypted-communication">4. <strong>Encrypted Communication</strong><a hidden class="anchor" aria-hidden="true" href="#4-encrypted-communication">¶</a></h3>
<ul>
<li>Once authentication is successful, both the client and the server agree on a shared symmetric encryption key that will be used for the session.</li>
<li>From this point onward, all data exchanged between the client and the server is encrypted using this shared key, ensuring confidentiality and integrity.</li>
</ul>
<h3 id="5-session-termination">5. <strong>Session Termination</strong><a hidden class="anchor" aria-hidden="true" href="#5-session-termination">¶</a></h3>
<ul>
<li>Once the task is complete, the client can disconnect from the server, and the SSH session is terminated. The session key used for encryption is discarded, ensuring that future sessions require fresh key exchanges.</li>
</ul>
<h3 id="key-components-of-ssh">Key Components of SSH:<a hidden class="anchor" aria-hidden="true" href="#key-components-of-ssh">¶</a></h3>
<ul>
<li><strong>Public Key Cryptography</strong>: Used for both server authentication and client authentication (when using key pairs).</li>
<li><strong>Encryption</strong>: Ensures that all communication between the client and server is secure and cannot be easily intercepted or tampered with.</li>
<li><strong>Integrity</strong>: Ensures that the data is not altered during transmission.</li>
</ul>
<h3 id="ssh-use-cases">SSH Use Cases:<a hidden class="anchor" aria-hidden="true" href="#ssh-use-cases">¶</a></h3>
<ul>
<li><strong>Remote Login</strong>: The most common use case—logging into a remote system to manage it.</li>
<li><strong>File Transfer</strong>: Tools like <code>SFTP</code> (SSH File Transfer Protocol) and <code>SCP</code> (Secure Copy Protocol) allow secure file transfer over SSH.</li>
<li><strong>Port Forwarding</strong>: SSH can be used to forward network traffic securely from one system to another, which is helpful in tunneling.</li>
<li><strong>Automation/Scripts</strong>: SSH is widely used in scripts and automation for managing remote servers, like in DevOps or system administration.</li>
</ul>
<p>In essence, SSH provides a secure way to manage remote systems by using encryption to protect the data being transmitted and ensuring both the client and server are properly authenticated.</p>


  </div>

  <footer class="post-footer">
  </footer>
    <div class="comments-separator"></div>
</article>
    </main>
    
<footer class="footer">
  <span>&copy; 2025 <a href="http://localhost:1313/">Narnacle&#39;s Dev Blog</a></span><span style="display: inline-block; margin-left: 1em;">
    <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA</a>
  </span>
  <span style="display: inline-block; margin-left: 1em;">
    Powered by
    <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
    <a href="https://github.com/reorx/hugo-PaperModX/" rel="noopener" target="_blank">PaperModX</a>
  </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
    <path d="M12 6H0l6-6z" />
  </svg>
</a>

<script>
  (function() {
     
    const disableThemeToggle = '' == '1';
    if (disableThemeToggle) {
      return;
    }

    let button = document.getElementById("theme-toggle")
    
    button.removeEventListener('click', toggleThemeListener)
    
    button.addEventListener('click', toggleThemeListener)
  })();
</script>

<script>
  (function () {
    let menu = document.getElementById('menu')
    if (menu) {
      menu.scrollLeft = localStorage.getItem("menu-scroll-position");
      menu.onscroll = function () {
        localStorage.setItem("menu-scroll-position", menu.scrollLeft);
      }
    }

    const disableSmoothScroll = '' == '1';
    const enableInstantClick = '' == '1';
    
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches || disableSmoothScroll || enableInstantClick) {
      return;
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener("click", function (e) {
        e.preventDefault();
        var id = this.getAttribute("href").substr(1);
        document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
          behavior: "smooth"
        });
        if (id === "top") {
          history.replaceState(null, null, " ");
        } else {
          history.pushState(null, null, `#${id}`);
        }
      });
    });
  })();
</script>
<script>
  var mybutton = document.getElementById("top-link");
  window.onscroll = function () {
    if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
      mybutton.style.visibility = "visible";
      mybutton.style.opacity = "1";
    } else {
      mybutton.style.visibility = "hidden";
      mybutton.style.opacity = "0";
    }
  };
</script>
<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied!';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>

</body>

</html>
